"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("chevrotain"),t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,r)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function r(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,u=i.length;s<u;s++,o++)n[o]=i[s];return n}function i(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})}var s=e.createToken({name:"whiteSpace",pattern:/\s+/,group:e.Lexer.SKIPPED}),u=e.createToken({name:"identifier",pattern:e.Lexer.NA}),a=e.createToken({name:"months",pattern:/JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC/,categories:[u]}),c=e.createToken({name:"days",pattern:/SUN|MON|TUE|WED|THU|FRI|SAT/,categories:[u]}),p=e.createToken({name:"dash",pattern:/-/}),h=e.createToken({name:"slash",pattern:/\//}),f=e.createToken({name:"comma",pattern:/,/}),l=e.createToken({name:"integer",pattern:/[0-9]{1,2}/,categories:[u]}),v=e.createToken({name:"every",pattern:/\*/,categories:[u]}),E=[s,u,a,c,p,h,f,l,v],m=i(E),x=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this,t)||this;return n.cronExpression=n.RULE("cronExpression",(function(){n.SUBRULE1(n.expression,{LABEL:"minutes"}),n.SUBRULE2(n.expression,{LABEL:"hours"}),n.SUBRULE3(n.expression,{LABEL:"dom"}),n.SUBRULE4(n.expression,{LABEL:"month"}),n.SUBRULE5(n.expression,{LABEL:"dow"})})),n.expression=n.RULE("expression",(function(){n.AT_LEAST_ONE_SEP({SEP:f,DEF:function(){return n.SUBRULE(n.exprNotUnion)}})})),n.exprNotUnion=n.RULE("exprNotUnion",(function(){n.CONSUME(u,{LABEL:"lhs"}),n.SUBRULE(n.atomicExpr)})),n.atomicExpr=n.RULE("atomicExpr",(function(){n.OPTION1({DEF:function(){return n.SUBRULE1(n.range)}}),n.OPTION2({DEF:function(){return n.SUBRULE2(n.interval)}})})),n.interval=n.RULE("interval",(function(){n.CONSUME1(h),n.CONSUME2(u,{LABEL:"rhs"})})),n.range=n.RULE("range",(function(){n.CONSUME1(p),n.CONSUME2(u,{LABEL:"rhs"})})),r||n.performSelfAnalysis(),n}return r(t,e),t}(e.CstParser),d=function(){function e(e,t,r){this._rhs=t,this._lhs=e,this._separator=r}return e.prototype.value=function(){return""+this._lhs.value()+this._separator+this._rhs.value()},e}(),y=function(){function e(e){this._value=e}return e.prototype.value=function(){return this._value},e}();function _(e,t){return new d(e,t,"/")}function L(e,t){return new d(e,t,"-")}var g,U=new y("*"),b=new y("?"),S=function(){function e(e,t,r,n,o){void 0===e&&(e=U),void 0===t&&(t=U),void 0===r&&(r=U),void 0===n&&(n=U),void 0===o&&(o=U),this._dow=o,this._minute=e,this._hour=t,this._dom=r,this._month=n}return Object.defineProperty(e.prototype,"minute",{get:function(){return this._minute},set:function(e){this._minute=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hour",{get:function(){return this._hour},set:function(e){this._hour=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dom",{get:function(){return this._dom},set:function(e){this._dom=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"month",{get:function(){return this._month},set:function(e){this._month=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dow",{get:function(){return this._dow},set:function(e){this._dow=e},enumerable:!1,configurable:!0}),e.prototype.value=function(){return this._minute.value()+" "+this._hour.value()+" "+this._dom.value()+" "+this._month.value()+" "+this._dow.value()},e}(),w=function(){function e(e){this._exprs=e}return e.prototype.value=function(){return this._exprs.map((function(e){return e.value()})).join(",")},e}(),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error),N=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.call(this,t)||this;return n.validateVisitor(),n}return r(t,e),t.prototype.cronExpression=function(e){var t=new S;return t.minute=this.visit(e.minutes),t.hour=this.visit(e.hours),t.dom=this.visit(e.dom),t.month=this.visit(e.month),t.dow=this.visit(e.dow),t},t.prototype.expression=function(e){var t=this,r=e.exprNotUnion.map((function(e){return t.visit(e)}));return new w(r)},t.prototype.exprNotUnion=function(e){var t=new y(e.lhs[0].image);return this.visit(e.atomicExpr,t)},t.prototype.atomicExpr=function(e,t){var r=t;if(e.range){var n=this.visit(e.range),o=Number(t.value()),i=Number(n.value());if(!isNaN(o)&&!isNaN(i)&&o>i)throw new Error("Left-hand side range value must be smaller than right-hand side");r=L(t,n)}return e.interval&&(r=_(r,this.visit(e.interval))),r},t.prototype.interval=function(e){return new y(e.rhs[0].image)},t.prototype.range=function(e){return new y(e.rhs[0].image)},t}(e)},A=function(e){function t(){return e.call(this,m)||this}return r(t,e),t}(x),R=N((new A).getBaseCstVisitorConstructor()),B=function(e){function t(){return e.call(this,R)||this}return r(t,e),t}(R);!function(e){e.CRONTAB="Crontab",e.QUARTZ="Quartz",e.JENKINS="Jenkins"}(g||(g={}));var P,T=g,C=e.createToken({name:"roundTime",pattern:/H/,categories:[u]}),k=o(E,[C]),j=i(k),I=function(e){function t(){var t=e.call(this,j,!0)||this;return t.performSelfAnalysis(),t}return r(t,e),t}(x),M=N((new I).getBaseCstVisitorConstructor()),V=function(e){function t(){return e.call(this,M)||this}return r(t,e),t}(M),D=e.createToken({name:"anyToken",pattern:/\?/,categories:[u]}),J=e.createToken({name:"sharp",pattern:/#/}),F=e.createToken({name:"last",pattern:/L/,categories:[u]}),G=e.createToken({name:"weekday",pattern:/W/,categories:[u]}),z=o(E,[D,J,F,G]),Q=i(z),K=function(e){function t(){var t=e.call(this,Q,!0)||this;return t.cronExpression=t.OVERRIDE_RULE("cronExpression",(function(){t.SUBRULE1(t.expression,{LABEL:"second"}),t.SUBRULE2(t.expression,{LABEL:"minutes"}),t.SUBRULE3(t.expression,{LABEL:"hours"}),t.SUBRULE4(t.expression,{LABEL:"dom"}),t.SUBRULE5(t.expression,{LABEL:"month"}),t.SUBRULE6(t.expression,{LABEL:"dow"}),t.OPTION({DEF:function(){return t.SUBRULE7(t.expression,{LABEL:"year"})}})})),t.exprNotUnion=t.OVERRIDE_RULE("exprNotUnion",(function(){t.CONSUME(u,{LABEL:"lhs"}),t.OPTION({DEF:function(){return t.OR([{ALT:function(){return t.SUBRULE(t.dow)}},{ALT:function(){return t.SUBRULE(t.atomicExpr)}}])}})})),t.dow=t.RULE("dow",(function(){t.OR([{ALT:function(){return t.CONSUME(F,{LABEL:"occurence"})}},{ALT:function(){t.CONSUME1(J),t.CONSUME2(l,{LABEL:"occurence"})}}])})),t.performSelfAnalysis(),t}return r(t,e),t}(x),Z=function(e){function t(t,r,n,o,i,s,u){void 0===t&&(t=U),void 0===r&&(r=U),void 0===n&&(n=U),void 0===o&&(o=U),void 0===i&&(i=b),void 0===s&&(s=U),void 0===u&&(u=U);var a=e.call(this,t,r,n,o,i)||this;return a._second=s,a._year=u,a}return r(t,e),t.prototype.value=function(){return this.second.value()+" "+e.prototype.value.call(this)+" "+this.year.value()},Object.defineProperty(t.prototype,"second",{get:function(){return this._second},set:function(e){this._second=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"year",{get:function(){return this._year},set:function(e){this._year=e},enumerable:!1,configurable:!0}),t}(S),q=function(){function e(e,t){this._leftValue=e,this._occurrence=t}return e.prototype.value=function(){var e=this._occurrence<5?"#"+this._occurrence:"L";return""+this._leftValue.value()+e},Object.defineProperty(e.prototype,"occurrence",{get:function(){return this._occurrence},set:function(e){if(e>5)throw new O("Occurrence value in Day of week expression should be less than or equal to 5");this._occurrence=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftValue",{get:function(){return this._leftValue},set:function(e){this._leftValue=e},enumerable:!1,configurable:!0}),e}(),W=N((new K).getBaseCstVisitorConstructor()),X=function(e){function t(){var t=e.call(this,W,!0)||this;return t.validateVisitor(),t}return r(t,e),t.prototype.cronExpression=function(e){var t=new Z;return e.second&&(t.second=this.visit(e.second)),t.minute=this.visit(e.minutes),t.hour=this.visit(e.hours),t.dom=this.visit(e.dom),t.month=this.visit(e.month),t.dow=this.visit(e.dow),e.year&&(t.year=this.visit(e.year)),t},t.prototype.exprNotUnion=function(e){var t=new y(e.lhs[0].image);return e.dow?this.visit(e.dow,t):this.visit(e.atomicExpr,t)},t.prototype.dow=function(e,t){var r="L"===e.occurence[0].image?5:parseInt(e.occurence[0].image,10);if(r>5)throw new O("Occurrence value in Day of week expression should be less than or equal to 5");return new q(t,r)},t}(W);function H(e){return"string"==typeof e?e:"number"==typeof e?String(e).valueOf():Array.isArray(e)?e.map(H).join(","):"*"}(P=exports.ParserStep||(exports.ParserStep={})).LEXING="lexing",P.PARSING="parsing",P.SEMANTIC="semantic";var Y=function(){function t(t,r,n){void 0===t&&(t={mode:T.CRONTAB,tokens:E}),this.mode=t.mode,this._lexer=new e.Lexer(t.tokens),this._parser=r,this._visitor=n,this.parse=this.parse.bind(this),this.reset=this.reset.bind(this)}return t.prototype.parse=function(e){var t=this;this.reset();var r=function(e,t){var r=t.mode;if("string"==typeof e)return e;var n=[H(e.minute),H(e.hour),H(e.dayOfMonth),H(e.month),H(e.dayOfWeek)];switch(r){case T.QUARTZ:var o=[void 0===e.second||null===e.second?"*":e.second].concat(n);return void 0!==e.year&&null!==e.year&&o.push(e.year),o.join(" ");case T.JENKINS:case T.CRONTAB:default:return n.join(" ")}}(e,{mode:this.mode});this._lexer.tokenize(r).errors.forEach((function(e){return t._errors.push({name:"LexingError",message:e.message,innerException:e,step:exports.ParserStep.LEXING})})),this._parser.input=this._lexer.tokenize(r).tokens;var o=this._parser.cronExpression();if(this._parser.errors.length>0)return this._parser.errors.map((function(e){return t._errors.push(n(n({},e),{innerException:e,step:exports.ParserStep.PARSING}))})),null;try{return this._visitor.visit(o)}catch(e){return this._errors.push(n(n({},e),{innerException:e,step:exports.ParserStep.SEMANTIC})),null}},t.prototype.parseField=function(e){var t=this;this.reset(),this._lexer.tokenize(e).errors.forEach((function(e){return t._errors.push({name:"LexingError",message:e.message,innerException:e,step:exports.ParserStep.LEXING})})),this._parser.input=this._lexer.tokenize(e).tokens;var r=this._parser.expression();if(this._parser.errors.length>0)return this._parser.errors.map((function(e){return t._errors.push(n(n({},e),{innerException:e,step:exports.ParserStep.PARSING}))})),null;try{return this._visitor.visit(r)}catch(e){return this._errors.push(n(n({},e),{innerException:e,step:exports.ParserStep.SEMANTIC})),null}},t.prototype.reset=function(){this._errors=[]},Object.defineProperty(t.prototype,"lexer",{get:function(){return this._lexer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parser",{get:function(){return this._parser},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visitor",{get:function(){return this._visitor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errors",{get:function(){return this._errors},enumerable:!1,configurable:!0}),t}(),$=function(e){function t(){return e.call(this,{mode:T.CRONTAB,tokens:E},new A,new B)||this}return r(t,e),t}(Y),ee=function(e){function t(){return e.call(this,{mode:T.QUARTZ,tokens:z},new K,new X)||this}return r(t,e),t}(Y),te=function(e){function t(){return e.call(this,{mode:T.JENKINS,tokens:k},new I,new V)||this}return r(t,e),t}(Y);exports.AbstractVisitorConstructor=N,exports.BaseCstParser=x,exports.CronExpression=S,exports.CronParser=$,exports.CronixMode=T,exports.CronixParser=Y,exports.DualExpression=d,exports.Expression=w,exports.InvalidValueException=O,exports.JenkinsParser=te,exports.QuartzParser=ee,exports.StringLiteral=y,exports.anyExpr=b,exports.baseTokens=E,exports.baseVocabulary=m,exports.comma=f,exports.cronix=function(e,t){void 0===t&&(t=T.CRONTAB);var r=function(e){switch(e){case T.JENKINS:return new te;case T.QUARTZ:return new ee;case T.CRONTAB:default:return new $}}(t),n=r.parse(e);return{ast:r.errors.length>0?null:n,errors:r.errors}},exports.dash=p,exports.days=c,exports.every=v,exports.everyExpr=U,exports.generateVocabulary=i,exports.identifier=u,exports.integer=l,exports.months=a,exports.rangeExpr=L,exports.slash=h,exports.stepExpr=_,exports.whiteSpace=s;
